-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TextService = game:GetService("TextService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")

-- Create Watermark UI
local watermarkGui = Instance.new("ScreenGui")
watermarkGui.Name = "WatermarkGui"
watermarkGui.Parent = PlayerGui

local watermarkFrame = Instance.new("Frame")
watermarkFrame.Name = "WatermarkFrame"
watermarkFrame.Size = UDim2.new(0, 200, 0, 100) -- Adjust size as needed
watermarkFrame.Position = UDim2.new(-150, 0.5, 0.02, 0)
watermarkFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
watermarkFrame.BackgroundTransparency = 0.5
watermarkFrame.BorderSizePixel = 0
watermarkFrame.Parent = watermarkGui

local watermarkTitle = Instance.new("TextLabel")
watermarkTitle.Name = "WatermarkTitle"
watermarkTitle.Size = UDim2.new(1, 0, 0, 30)
watermarkTitle.Text = "Watermark v5"
watermarkTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
watermarkTitle.TextScaled = true
watermarkTitle.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
watermarkTitle.BackgroundTransparency = 0.5
watermarkTitle.BorderSizePixel = 0
watermarkTitle.Parent = watermarkFrame

local fpsLabel = Instance.new("TextLabel")
fpsLabel.Name = "FPSLabel"
fpsLabel.Size = UDim2.new(1, 0, 0, 20)
fpsLabel.Position = UDim2.new(0, 0, 0.2, 0)
fpsLabel.Text = "FPS: "
fpsLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
fpsLabel.TextScaled = true
fpsLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
fpsLabel.BackgroundTransparency = 0.5
fpsLabel.BorderSizePixel = 0
fpsLabel.Parent = watermarkFrame

local pingLabel = Instance.new("TextLabel")
pingLabel.Name = "PingLabel"
pingLabel.Size = UDim2.new(1, 0, 0, 20)
pingLabel.Position = UDim2.new(0, 0, 0.4, 0)
pingLabel.Text = "Ping: "
pingLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
pingLabel.TextScaled = true
pingLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
pingLabel.BackgroundTransparency = 0.5
pingLabel.BorderSizePixel = 0
pingLabel.Parent = watermarkFrame

local walkSpeedLabel = Instance.new("TextLabel")
walkSpeedLabel.Name = "WalkSpeedLabel"
walkSpeedLabel.Size = UDim2.new(1, 0, 0, 20)
walkSpeedLabel.Position = UDim2.new(0, 0, 0.6, 0)
walkSpeedLabel.Text = "WalkSpeed: "
walkSpeedLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
walkSpeedLabel.TextScaled = true
walkSpeedLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
walkSpeedLabel.BackgroundTransparency = 0.5
walkSpeedLabel.BorderSizePixel = 0
walkSpeedLabel.Parent = watermarkFrame

-- Function to update watermark values
local function updateWatermark()
    -- Update FPS
    local fps = math.floor(1 / RunService.RenderStepped:Wait())
    fpsLabel.Text = "FPS: " .. tostring(fps)

    -- Update Ping (Note: Requires a custom method or third-party service for actual ping data)
    local ping = "N/A" -- Replace this with actual ping detection if possible
    pingLabel.Text = "Ping: " .. tostring(ping)

    -- Update WalkSpeed
    if LocalPlayer and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        walkSpeedLabel.Text = "WalkSpeed: " .. tostring(LocalPlayer.Character.Humanoid.WalkSpeed)
    end
end

-- Connect the update function to RenderStepped
RunService.RenderStepped:Connect(function()
    updateWatermark()
end)

-- Make UI movable (optional, as previously provided)
local dragging = false
local dragStart = Vector2.new()
local startPos = UDim2.new()

local function onDragStart(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = watermarkFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end

local function onDragMove(input)
    if dragging then
        local delta = input.Position - dragStart
        watermarkFrame.Position = UDim2.new(
            startPos.X.Scale,
            startPos.X.Offset + delta.X,
            startPos.Y.Scale,
            startPos.Y.Offset + delta.Y
        )
    end
end

UserInputService.InputBegan:Connect(onDragStart)
UserInputService.InputChanged:Connect(onDragMove)

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

-- Settings for AimLock, BulletTrace, Airshot, and Dot
local Settings = {
    AimLock = {
        Enabled = false,
        AimLockKey = Enum.KeyCode.Q,
        Prediction = 0.2,
        AirshotPredictionMultiplier = 1.5,
        AimPart = "HumanoidRootPart",
        NotificationDuration = 2,
        ChanceHitPrediction = 0.8,
        HighChanceThreshold = 0.9,
        HitChance = 0.7,
        Mode = "Legit" -- Default mode
    },
    BulletTrace = {
        Enabled = true,
        Color = Color3.fromRGB(255, 0, 0),
        Thickness = 2,
        LineCount = 20,
        LineLength = 100
    },
    Airshot = {
        Enabled = true,
        BasePrediction = 0.1,
        AirshotAccuracyFactor = 1.2
    },
    DotSettings = {
        Enabled = true,
        DotColor = Color3.fromRGB(255, 0, 0),
        DotRadius = 5
    }
}

-- Create ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "Nerverias.shhh test"
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- Create Main Frame with scrolling functionality
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 450, 0, 450)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -250) -- Centering
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- Create a ScrollingFrame inside the MainFrame
local scrollingFrame = Instance.new("ScrollingFrame")
scrollingFrame.Name = "ScrollingFrame"
scrollingFrame.Size = UDim2.new(1, -20, 1, -60)
scrollingFrame.Position = UDim2.new(0, 10, 0, 50)
scrollingFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
scrollingFrame.BorderSizePixel = 0
scrollingFrame.ScrollBarThickness = 8
scrollingFrame.Parent = mainFrame

-- Define buttonSpacing and modes
local buttonSpacing = 50
local modes = { "Legit", "Smooth", "Vertical" }

-- Create Title
local title = Instance.new("TextLabel")
title.Name = "Title"
title.Size = UDim2.new(1, 0, 0, 40)
title.Position = UDim2.new(0, 0, 0, 0)
title.Text = "Nerverias.shhh test"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextScaled = true
title.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
title.Parent = scrollingFrame

-- Create Mode Label
local modeLabel = Instance.new("TextLabel")
modeLabel.Name = "ModeLabel"
modeLabel.Size = UDim2.new(0, 200, 0, 30)
modeLabel.Position = UDim2.new(0, 25, 0, buttonSpacing * (#modes + 1))
modeLabel.Text = "Mode: " .. Settings.AimLock.Mode
modeLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
modeLabel.TextScaled = true
modeLabel.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
modeLabel.Parent = scrollingFrame

-- Create Mode Buttons
for i, mode in ipairs(modes) do
    local modeButton = Instance.new("TextButton")
    modeButton.Name = mode .. "Button"
    modeButton.Size = UDim2.new(0, 100, 0, 40)
    modeButton.Position = UDim2.new(0, 25, 0, buttonSpacing * i)
    modeButton.Text = mode
    modeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    modeButton.TextScaled = true
    modeButton.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    modeButton.Parent = scrollingFrame

    modeButton.MouseButton1Click:Connect(function()
        Settings.AimLock.Mode = mode
        modeLabel.Text = "Mode: " .. Settings.AimLock.Mode
        ApplyModeSettings(Settings.AimLock.Mode)
    end)
end

-- Create TextBoxes and Labels for Settings
local settingsLabels = {
    { Name = "HitChance", Text = "Hit Chance: " },
    { Name = "HighChanceThreshold", Text = "High Chance Threshold: " },
    { Name = "ChanceHitPrediction", Text = "Chance Hit Prediction: " },
    { Name = "AirshotPrediction", Text = "Airshot Prediction: " },
    { Name = "BasePrediction", Text = "Base Prediction: " },
    { Name = "AirshotAccuracyFactor", Text = "Airshot Accuracy Factor: " }
}

local textBoxes = {}

for i, labelInfo in ipairs(settingsLabels) do
    local label = Instance.new("TextLabel")
    label.Name = labelInfo.Name .. "Label"
    label.Size = UDim2.new(0, 200, 0, 30)
    label.Position = UDim2.new(0, 25, 0, buttonSpacing * (#modes + 2 + i - 1))
    label.Text = labelInfo.Text .. tostring(Settings.AimLock[labelInfo.Name] or Settings.Airshot[labelInfo.Name] or "Not Set")
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextScaled = true
    label.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    label.Parent = scrollingFrame

    local textBox = Instance.new("TextBox")
    textBox.Name = labelInfo.Name .. "TextBox"
    textBox.Size = UDim2.new(0, 80, 0, 30)
    textBox.Position = UDim2.new(0, 200, 0, buttonSpacing * (#modes + 2 + i - 1))
    textBox.Text = tostring(Settings.AimLock[labelInfo.Name] or Settings.Airshot[labelInfo.Name])
    textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
    textBox.TextScaled = true
    textBox.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    textBox.Parent = scrollingFrame

    textBox.Changed:Connect(function(property)
        if property == "Text" then
            local value = tonumber(textBox.Text)
            if value then
                Settings.AimLock[labelInfo.Name] = value
                Settings.Airshot[labelInfo.Name] = value
                label.Text = labelInfo.Text .. tostring(value)
            end
        end
    end)

    textBoxes[labelInfo.Name] = textBox
end

-- Create Toggle Button
local toggleButton = Instance.new("TextButton")
toggleButton.Name = "ToggleButton"
toggleButton.Size = UDim2.new(0, 100, 0, 40)
toggleButton.Position = UDim2.new(0.5, -50, 0, 10)
toggleButton.Text = "Hide"
toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleButton.TextScaled = true
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 150, 150)
toggleButton.Parent = screenGui

toggleButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
    toggleButton.Text = mainFrame.Visible and "Hide" or "Show"
end)

-- Create No Crash Button
local noCrashButton = Instance.new("TextButton")
noCrashButton.Name = "NoCrashButton"
noCrashButton.Size = UDim2.new(0, 100, 0, 40)
noCrashButton.Position = UDim2.new(0.5, -50, 0, 60)
noCrashButton.Text = "No Crash"
noCrashButton.TextColor3 = Color3.fromRGB(255, 255, 255)
noCrashButton.TextScaled = true
noCrashButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
noCrashButton.Parent = screenGui

noCrashButton.MouseButton1Click:Connect(function()
    -- Simulate ping reduction
    local player = Players.LocalPlayer
    local playerPing = player.PlayerGui:FindFirstChild("Ping")
    
    if playerPing and playerPing.Text and tonumber(playerPing.Text) > 250 then
        local reducedPing = math.max(190, tonumber(playerPing.Text) - 60) -- Adjust ping to be less than 250
        playerPing.Text = tostring(reducedPing)
        showNotification("Ping Adjusted", "Ping has been adjusted to " .. reducedPing .. " ms.", 2)
    end
end)

-- Apply Mode Settings Function
local function ApplyModeSettings(mode)
    if mode == "Legit" then
        Settings.AimLock.Prediction = 0.3
        Settings.AimLock.ChanceHitPrediction = 0.7
        Settings.AimLock.HighChanceThreshold = 0.8
        Settings.AimLock.HitChance = 0.5
    elseif mode == "Smooth" then
        Settings.AimLock.Prediction = 0.1
        Settings.AimLock.ChanceHitPrediction = 0.5
        Settings.AimLock.HighChanceThreshold = 0.7
        Settings.AimLock.HitChance = 0.6
    elseif mode == "Vertical" then
        Settings.AimLock.Prediction = 0.2
        Settings.AimLock.ChanceHitPrediction = 0.6
        Settings.AimLock.HighChanceThreshold = 0.7
        Settings.AimLock.HitChance = 0.7
    end

    -- Update TextBoxes
    for name, textBox in pairs(textBoxes) do
        textBox.Text = tostring(Settings.AimLock[name] or Settings.Airshot[name])
    end
end

-- Initial Application of Mode Settings
ApplyModeSettings(Settings.AimLock.Mode)

-- Add Notification Function
local function showNotification(title, text, duration)
    local notification = Instance.new("Frame")
    notification.Size = UDim2.new(0, 200, 0, 50)
    notification.Position = UDim2.new(0.5, -100, 0, 10)
    notification.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    notification.BorderSizePixel = 0
    notification.Parent = screenGui

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Size = UDim2.new(1, 0, 0, 20)
    titleLabel.Text = title
    titleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    titleLabel.TextScaled = true
    titleLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    titleLabel.Parent = notification

    local textLabel = Instance.new("TextLabel")
    textLabel.Size = UDim2.new(1, 0, 0, 30)
    textLabel.Position = UDim2.new(0, 0, 0.25, 0)
    textLabel.Text = text
    textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    textLabel.TextScaled = true
    textLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    textLabel.Parent = notification

    Debris:AddItem(notification, duration)
end

-- Update Watermark Function
local function updateWatermark()
    -- Add FPS and Ping update logic here
end

-- Call updateWatermark regularly
RunService.Heartbeat:Connect(function()
    updateWatermark()
end)

-- Additional Functions for AimLock, BulletTrace, Airshot, and Dot will follow
-- Function to aim at the target with prediction and settings according to the mode
local function AimAtTarget(target)
    if target and target.Character and target.Character:FindFirstChild(Settings.AimLock.AimPart) then
        local targetPart = target.Character[Settings.AimLock.AimPart]
        local predictedPosition

        local airshotPrediction = Settings.Airshot.Enabled and CalculateAirshotPrediction(Settings.AimLock.ChanceHitPrediction) or Settings.AimLock.Prediction

        if target.Character.Humanoid:GetState() == Enum.HumanoidStateType.Freefall then
            local randomness = 0
            if Settings.AimLock.Mode == "Legit" then
                randomness = math.random() * 0.5
            end

            predictedPosition = targetPart.Position + (targetPart.Velocity * (airshotPrediction + randomness))
        else
            predictedPosition = targetPart.Position + (targetPart.Velocity * airshotPrediction)
        end

        Camera.CFrame = CFrame.new(Camera.CFrame.Position, predictedPosition)
        createLineTrace(Camera.CFrame.Position, predictedPosition)

        -- Simulate shooting based on chance hit
        if ChanceHit() then
            print("Hit at:", predictedPosition)
            -- Add actual shooting logic here
        else
            print("Missed shot at:", predictedPosition)
        end
    end
end

